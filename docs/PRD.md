# 新核芯知识库智能体系统 产品需求文档 (PRD)

> 最后更新: 2026-01-06 | 版本: 1.1

---

## 一、项目概述

### 1.1 项目愿景

为青岛新核芯科技有限公司（半导体生产企业）搭建本地部署的**知识库 + 智能体 + 培训考试**一体化平台，实现企业知识资产的智能化管理与应用。

### 1.2 目标用户

| 角色 | 描述 | 核心诉求 |
|------|------|----------|
| 普通员工 | 生产、研发、IT等部门员工 | 快速查询知识、完成培训考试 |
| 部门负责人 | 各部门管理者 | 管理部门知识库、查看培训报表 |
| 系统管理员 | IT管理员 | 系统配置、权限管理、用户管理 |
| 知识管理员 | 知识库维护人员 | 上传文档、维护知识分类 |

### 1.3 项目约束

| 维度 | 约束条件 |
|------|----------|
| 用户规模 | <100人 |
| 安全级别 | 企业内部保密（基于角色权限控制） |
| 认证系统 | 新建用户管理系统 |
| 服务器预算 | 10-30万 |
| 部署方式 | 本地化部署（数据不出企业） |
| 访问终端 | Web端 + 钉钉集成 |
| 数据规模 | 约 5TB 文件 |
| 图纸解读 | 仅文本/元数据检索（不使用视觉模型） |

---

## 二、功能清单

### 状态说明
- 🔴 待开发 | 🟡 开发中 | 🟢 已完成 | ⚫ 已废弃

### 功能总览

#### 2.1 多层级知识库

| ID | 功能 | 状态 | 优先级 | 对应代码 |
|----|------|------|--------|----------|
| KB-001 | 多层级分类 | 🟡 | P0 | frontend/src/app/admin/knowledge/page.tsx |
| KB-002 | 领域划分 | 🟡 | P0 | frontend/src/app/admin/knowledge/page.tsx |
| KB-003 | 自定义层级 | 🔴 | P1 | - |
| KB-004 | 多格式支持 | 🟡 | P0 | frontend/src/app/admin/knowledge/page.tsx (UI) |
| KB-005 | 全文检索 | 🔴 | P0 | - |
| KB-006 | 版本管理 | 🔴 | P2 | - |

> 💡 KB-001/002/004 前端UI已完成，展示13种文件格式和AI提取状态

#### 2.2 智能体系统

| ID | 功能 | 状态 | 优先级 | 对应代码 |
|----|------|------|--------|----------|
| AG-001 | 智能体创建 | 🟡 | P0 | frontend/src/app/admin/agents/page.tsx |
| AG-002 | 权限控制 | 🟡 | P0 | frontend/src/app/admin/agents/page.tsx |
| AG-003 | 多轮对话 | 🟡 | P0 | frontend/src/app/chat/page.tsx |
| AG-004 | 图纸检索 | 🟡 | P1 | frontend/src/app/admin/agents/page.tsx (图纸解读智能体) |
| AG-005 | 工艺查询 | 🟡 | P1 | frontend/src/app/admin/agents/page.tsx (工艺专家智能体) |
| AG-006 | 入职助手 | 🟡 | P1 | frontend/src/app/admin/agents/page.tsx |
| AG-007 | IT帮助台 | 🟡 | P1 | frontend/src/app/admin/agents/page.tsx |

> 💡 智能体系统前端UI已完成：6种智能体类型、权限设置、用户对话界面

#### 2.3 培训考试系统

| ID | 功能 | 状态 | 优先级 | 对应代码 |
|----|------|------|--------|----------|
| TR-001 | 培训场景管理 | 🟡 | P0 | frontend/src/app/admin/training/scenes/page.tsx |
| TR-002 | 题库管理 | 🟡 | P0 | frontend/src/app/admin/training/questions/page.tsx |
| TR-003 | 智能组卷 | 🔴 | P1 | - |
| TR-004 | 在线考试 | 🟡 | P0 | frontend/src/app/admin/training/exams/page.tsx |
| TR-005 | 成绩分析 | 🟡 | P1 | frontend/src/app/admin/training/records/page.tsx |
| TR-006 | 证书颁发 | 🔴 | P2 | - |

> 💡 培训考试前端UI已完成，包含场景管理、题库管理、试卷管理、考试记录

#### 2.4 用户权限系统

| ID | 功能 | 状态 | 优先级 | 对应代码 |
|----|------|------|--------|----------|
| US-001 | 用户管理 | 🟡 | P0 | frontend/src/app/admin/system/users/page.tsx |
| US-002 | 角色管理 | 🟡 | P0 | frontend/src/app/admin/system/roles/page.tsx |
| US-003 | 权限矩阵 | 🔴 | P0 | - |
| US-004 | 部门组织 | 🟡 | P1 | frontend/src/app/admin/system/departments/page.tsx |
| US-005 | 审计日志 | 🟡 | P1 | frontend/src/app/admin/system/logs/page.tsx |

> 💡 系统管理前端UI已完成，包含用户、角色、部门、日志管理页面

---

## 三、功能详情

### KB-001: 多层级分类

- **用户故事**: 作为知识管理员，我希望按安全级别创建多层级知识库（通用/涉密/运营等）
- **验收标准**:
  - [ ] 支持创建多级知识库目录树
  - [ ] 每个知识库可设置独立的访问权限
  - [ ] 支持拖拽调整层级顺序
- **技术备注**: 使用树形结构存储，递归查询

### KB-002: 领域划分

- **用户故事**: 作为员工，我希望在同一安全级别内按领域（研发/IT/生产）快速定位知识
- **验收标准**:
  - [ ] 支持在同一层级内创建多个领域分类
  - [ ] 领域可自定义图标和颜色
  - [ ] 支持跨领域搜索

### KB-004: 多格式支持

- **用户故事**: 作为知识管理员，我希望上传各种格式的文档到知识库
- **验收标准**:
  - [ ] 支持 Word/PDF/Excel/PPT 文档
  - [ ] 支持视频文件（MP4/AVI）
  - [ ] 支持 CAD 图纸（DXF/DWG）
  - [ ] 支持芯片设计文件（GDS/GDSII）
  - [ ] 上传时自动提取文本内容进行向量化
- **技术备注**: 使用 Unstructured 库解析，LangChain 处理

### KB-005: 全文检索

- **用户故事**: 作为员工，我希望通过关键词或自然语言搜索知识库内容
- **验收标准**:
  - [ ] 支持关键词精确匹配
  - [ ] 支持语义相似度搜索
  - [ ] 搜索结果高亮关键词
  - [ ] 支持按时间/相关度排序
- **技术备注**: 向量存储使用 Milvus，Embedding 使用 BGE-M3

### AG-001: 智能体创建

- **用户故事**: 作为管理员，我希望基于一个或多个知识库创建专用智能体
- **验收标准**:
  - [ ] 可选择关联的知识库（单选或多选）
  - [ ] 可配置智能体名称、描述、图标
  - [ ] 可设置系统提示词（System Prompt）
  - [ ] 支持智能体启用/禁用
- **关联接口**: POST /api/agents

### AG-002: 权限控制

- **用户故事**: 作为管理员，我希望控制哪些用户/角色可以使用哪些智能体
- **验收标准**:
  - [ ] 支持按用户配置智能体访问权限
  - [ ] 支持按角色配置智能体访问权限
  - [ ] 支持按部门配置智能体访问权限
  - [ ] 权限变更实时生效

### AG-003: 多轮对话

- **用户故事**: 作为员工，我希望与智能体进行上下文连贯的多轮对话
- **验收标准**:
  - [ ] 支持上下文记忆（最近N轮）
  - [ ] 支持会话管理（新建/删除/历史）
  - [ ] 支持对话导出
- **技术备注**: 使用 Qwen2.5-7B-Instruct，上下文窗口 32K

### TR-002: 题库管理

- **用户故事**: 作为培训管理员，我希望创建和管理考试题目
- **验收标准**:
  - [ ] 支持单选题、多选题、判断题、填空题
  - [ ] 支持题目分类和标签
  - [ ] 支持批量导入题目（Excel）
  - [ ] 支持题目难度设置
- **关联接口**: POST /api/questions

### TR-003: 智能组卷

- **用户故事**: 作为培训管理员，我希望自动生成试卷
- **验收标准**:
  - [ ] 支持按知识点自动抽题
  - [ ] 支持按难度比例组卷
  - [ ] 支持设置总分和题目数量
  - [ ] 支持试卷预览

### TR-004: 在线考试

- **用户故事**: 作为员工，我希望在线完成培训考试
- **验收标准**:
  - [ ] 支持考试限时
  - [ ] 支持防作弊（切屏检测、禁止复制）
  - [ ] 自动提交（时间到或主动提交）
  - [ ] 考试完成后立即显示成绩
- **技术备注**: 前端使用 Web Worker 计时

### US-003: 权限矩阵

- **用户故事**: 作为管理员，我希望通过权限矩阵一目了然地管理所有权限
- **验收标准**:
  - [ ] 行：用户/角色/部门
  - [ ] 列：知识库访问 × 智能体使用 × 培训参与
  - [ ] 支持批量授权/撤权
  - [ ] 支持权限继承（部门→角色→用户）

---

## 四、技术架构

### 4.1 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                     前端 (Web/钉钉)                          │
│              Vue3 + Ant Design Vue + 钉钉SDK                │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      API 网关 (Nginx)                        │
└─────────────────────────────────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│   知识库服务   │   │   智能体服务   │   │  培训考试服务  │
│  (FastAPI)    │   │  (FastAPI)    │   │  (FastAPI)    │
└───────────────┘   └───────────────┘   └───────────────┘
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ▼                     ▼                     ▼
┌───────────────┐   ┌───────────────┐   ┌───────────────┐
│   向量数据库   │   │    本地LLM    │   │   关系数据库   │
│   (Milvus)    │   │ (Qwen2.5-7B) │   │    (MySQL)    │
└───────────────┘   └───────────────┘   └───────────────┘
        │                     │
        ▼                     ▼
┌───────────────┐   ┌───────────────┐
│   文件存储     │   │   Embedding   │
│   (MinIO)     │   │   (BGE-M3)    │
└───────────────┘   └───────────────┘
```

### 4.2 技术选型

| 层级 | 技术 | 说明 |
|------|------|------|
| 前端 | Vue3 + Ant Design Vue | 成熟稳定，企业级组件 |
| 后端 | Python FastAPI | 异步高性能，类型提示 |
| 数据库 | MySQL 8.0 | 关系型数据存储 |
| 向量库 | Milvus 2.x | 高性能向量检索 |
| 对象存储 | MinIO | 文件存储，S3兼容 |
| LLM推理 | vLLM / Ollama | 本地模型部署 |
| 文档解析 | Unstructured | 多格式文档解析 |
| 消息队列 | Redis | 异步任务、缓存 |
| 企业集成 | 钉钉SDK | 工作台H5应用 |

### 4.3 推荐模型

| 用途 | 模型 | 显存需求 |
|------|------|----------|
| 主对话 | Qwen2.5-7B-Instruct | 16GB |
| 向量化 | BGE-M3 | 4GB |

> 图纸解读采用文本/元数据检索方式，不使用视觉模型

### 4.4 服务器配置建议（约20万）

| 组件 | 配置 | 说明 |
|------|------|------|
| 应用服务器 | 32核CPU / 128GB内存 / 1TB SSD | 运行Web服务、API |
| GPU服务器 | NVIDIA A30 24GB × 2 | 运行大模型推理 |
| 存储服务器 | 10TB HDD RAID / 1TB SSD缓存 | 存储5TB文件 |
| 网络设备 | 千兆交换机 | 内网通信 |

---

## 五、数据模型概览

| 实体 | 说明 | 主要字段 |
|------|------|----------|
| User | 用户表 | id, username, email, phone, password, department_id, role_id, status |
| Department | 部门表 | id, name, parent_id, sort_order |
| Role | 角色表 | id, name, description, permissions |
| KnowledgeBase | 知识库表 | id, name, level, domain, parent_id, access_level |
| Document | 文档表 | id, kb_id, title, file_path, file_type, content_hash, vector_status |
| Agent | 智能体表 | id, name, description, system_prompt, kb_ids, status |
| AgentPermission | 智能体权限表 | id, agent_id, target_type, target_id |
| Conversation | 对话表 | id, user_id, agent_id, title, created_at |
| Message | 消息表 | id, conversation_id, role, content, created_at |
| TrainingScene | 培训场景表 | id, name, description, status |
| Question | 题目表 | id, scene_id, type, content, options, answer, difficulty |
| Exam | 考试表 | id, scene_id, title, duration, total_score, pass_score |
| ExamRecord | 考试记录表 | id, exam_id, user_id, score, start_time, submit_time, status |
| AuditLog | 审计日志表 | id, user_id, action, target_type, target_id, detail, created_at |

---

## 六、项目里程碑

| 阶段 | 内容 | 交付物 |
|------|------|--------|
| P1 基础设施 | 服务器部署、数据库、存储、模型部署 | 基础环境就绪 |
| P2 知识库 | 多层级分类、文件上传、向量化、检索 | 知识库模块上线 |
| P3 智能体 | 对话服务、知识库关联、权限控制 | 智能体模块上线 |
| P4 培训考试 | 题库、组卷、考试、成绩分析 | 培训考试模块上线 |
| P5 集成优化 | 钉钉集成、性能优化、安全加固 | 系统全面上线 |

---

## 七、变更历史

| 日期 | 版本 | 变更内容 | 操作人 |
|------|------|----------|--------|
| 2026-01-06 | 1.0 | 初始版本，完成需求梳理 | AI |
| 2026-01-06 | 1.1 | 前端UI开发完成，更新功能状态 | AI |

### 1.1 版本变更明细

**前端页面开发完成：**
- 知识库管理页面：支持13种文件格式展示、AI提取状态显示
- 智能体管理页面：6种智能体类型、权限设置、对话测试
- 控制台大屏：数据统计、智能体排行、系统状态监控
- 用户对话界面：`/chat` 页面，智能体选择、多轮对话
- 培训考试：场景管理、题库管理、试卷管理、考试记录
- 系统管理：用户、角色、部门、日志管理

---

## 八、附录

### 8.1 术语表

| 术语 | 说明 |
|------|------|
| 知识库 | 存储和管理企业文档的逻辑容器 |
| 智能体 | 基于知识库的AI对话助手 |
| 向量化 | 将文本转换为数值向量用于语义检索 |
| Embedding | 文本嵌入向量表示 |
| RAG | 检索增强生成，结合知识库回答问题 |

### 8.2 参考文档

- [钉钉开放平台文档](https://open.dingtalk.com/)
- [Milvus 官方文档](https://milvus.io/docs)
- [Qwen 模型文档](https://github.com/QwenLM/Qwen)
